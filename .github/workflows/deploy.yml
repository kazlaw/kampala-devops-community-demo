name: Deploy to Kampala VM
on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: SSH and Update Nginx
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.VM_IP }}
          username: ${{ secrets.VM_USER }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          script: |
            # Create the file directly on the VM
            sudo bash -c 'cat <<EOF > /var/www/html/index.html
            <!DOCTYPE html>
            <html>
            <head>
                <title>DevOps Kampala</title>
                <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
            </head>
            <body class="bg-light text-center" style="padding-top: 100px;">
                <div class="container bg-white p-5 shadow rounded">
                    <h1 class="display-4 text-primary">ðŸ‡ºðŸ‡¬ DevOps Community Kampala</h1>
                    <p class="lead">Live Deployment via GitHub Actions</p>
                    <div class="alert alert-info">Last Updated: $(date)</div>
                </div>
            </body>
            </html>
            EOF'
            sudo systemctl reload nginx
